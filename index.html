<!doctype html>
<html>

<body>
  <label for="sel">html-imports</label>
  <select id="sel" onchange="version = this.value">
    <option value="v0" selected>v0</option>
    <option value="v1-es5">v1-es5</option>
    <option value="v1-es6">v1-es6</option>
  </select>
  <p>
    <button onclick="startTests()">start</button>
    <button onclick="stopTests()">stop</button>
  </p>
  <pre id="out"></pre>
  <script>
    var count = 0;
    var total = 20;

    var versions = ['v0', 'v1-es5', 'v1-es6'];
    var version = sel.value;

    var times = {};
    for (var i = 0; i < versions.length; i++) {
      var arr = [];
      arr.avg = 0;
      times[versions[i]] = arr;
    }

    function startTests() {
      stopTests();
      count = 0;
      runTest();
    }

    function stopTests() {
      clearTimeout(runTest.timeout);
    }

    function runTest() {
      count++;
      window.open('imports.html?version=' + version, 'test#' + count);
    }

    function printTimes() {
      out.textContent =
        `v0\t\tv1\t\tv1(es6)\t\tv0 - v1\t\t\tv1 - v1(es6)
${
  times['v0'].avg.toFixed(2)}\t\t${times['v1-es5'].avg.toFixed(2)
}\t\t${
  times['v1-es6'].avg.toFixed(2)
}\t\t${
  (times['v0'].avg - times['v1-es5'].avg).toFixed(2)
} (${
  (100 * (times['v0'].avg - times['v1-es5'].avg) / times['v0'].avg).toFixed(2)
}%)\t\t${
  (times['v1-es5'].avg - times['v1-es6'].avg).toFixed(2)
} (${
  (100 * (times['v1-es5'].avg - times['v1-es6'].avg) / times['v1-es5'].avg).toFixed(2)
}%)


v0\t\tv1\t\tv1(es6)
`;
      var maxLength = Math.max(0, times['v0'].length, times['v1-es5'].length,
        times['v1-es6'].length);
      for (var i = 0; i < maxLength; i++) {
        out.textContent +=
          `${
            times['v0'][i] ? times['v0'][i].toFixed(2) : '-'
          }\t\t${
            times['v1-es5'][i] ? times['v1-es5'][i].toFixed(2) : '-'
          }\t\t${
            times['v1-es6'][i] ? times['v1-es6'][i].toFixed(2) : '-'
          }\n`;
      }
    }

    function importsLoaded(time) {
      times[version].push(time);
      times[version].avg = (times[version].avg * (times[version].length - 1) +
        time) / times[version].length;
      printTimes();
      if (count < total) {
        runTest.timeout = setTimeout(runTest, 1000);
      }
    }
  </script>
</body>

</html>
