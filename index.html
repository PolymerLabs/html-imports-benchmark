<!doctype html>
<html>

<body>
  <label for="sel">html-imports</label>
  <select id="sel" onchange="version = this.value">
    <option value="v0" selected>v0</option>
    <option value="v1-es5">v1-es5</option>
    <option value="v1-es6">v1-es6</option>
  </select>
  <p>
    <button onclick="startTests()">start</button>
    <button onclick="stopTests()">stop</button>
  </p>
  <pre id="out"></pre>
  <script>
    var count = 0;
    var total = 20;

    var versions = ['v0', 'v1-es5', 'v1-es6'];
    var version = sel.value;

    var times = {};
    for (var i = 0; i < versions.length; i++) {
      times[versions[i]] = [];
    }

    function startTests() {
      stopTests();
      count = 0;
      runTest();
    }

    function stopTests() {
      clearTimeout(runTest.timeout);
    }

    function runTest() {
      count++;
      window.open('imports.html?version=' + version, 'test#' + count);
    }

    function printTimes() {
      out.textContent = 'v0\t\tv1-es5\t\tv1-es6\n';
      for (var i = 0; i < total; i++) {
        out.textContent +=
          `${times['v0'][i] || '-'}\t\t${times['v1-es5'][i] || '-'}\t\t${times['v1-es6'][i] || '-'}\n`;
      }
    }

    function importsLoaded(time) {
      times[version].push(parseFloat(time.toFixed(3)));
      printTimes();
      if (count < total) {
        runTest.timeout = setTimeout(runTest, 1000);
      }
    }
  </script>
</body>

</html>
