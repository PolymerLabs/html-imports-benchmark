<!doctype html>
<html>

<body>
  <label for="sel">html-imports</label>
  <select id="sel" onchange="version = this.value">
    <option value="v0" selected>v0</option>
    <option value="v1-es5">v1-es5</option>
    <option value="v1-es6">v1-es6</option>
  </select>
  <p>
    <button onclick="startTests()">start</button>
    <button onclick="stopTests()">stop</button>
  </p>
  <pre id="out"></pre>
  <script>
    var count = 0;
    var total = 20;
    version = 'v0';
    var results = {
      'v0': [],
      'v1-es5': [],
      'v1-es6': []
    };

    function startTests() {
      stopTests();
      count = 0;
      runTest();
    }

    function stopTests() {
      clearTimeout(runTest.timeout);
    }

    function runTest() {
      count++;
      window.open('imports.html?version=' + version, 'test#' + count);
    }

    function printResults() {
      out.textContent = 'v0\tv1-es5\tv1-es6\n';
      for (var i = 0; i < total; i++) {
        out.textContent +=
          `${results['v0'][i] || '-'}\t${results['v1-es5'][i] || '-'}\t${results['v1-es6'][i] || '-'}\n`;
      }
    }

    function importsLoaded(time, win) {
      if (!win || !time) {
        return;
      }
      results[version].push(time);
      printResults();
      win.close();
      if (count < total) {
        runTest.timeout = setTimeout(runTest, 1000);
      }
    }
  </script>
</body>

</html>
